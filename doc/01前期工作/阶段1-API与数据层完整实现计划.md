# ğŸ¯ é˜¶æ®µ1ï¼šAPIä¸æ•°æ®å±‚å®Œæ•´å®ç°è®¡åˆ’

> **æ ¸å¿ƒç›®æ ‡**: æ„å»ºé«˜è´¨é‡ã€å¯éªŒè¯ã€æ˜“æ‰©å±•çš„æ•°æ®åº•å±‚  
> **éªŒè¯æ–¹å¼**: å®Œæ•´çš„APIéªŒè¯å·¥å…·  
> **å¼€å‘æ¨¡å¼**: è¾¹åˆ¶ä½œã€è¾¹éªŒè¯ã€è¾¹ä¼˜åŒ–

---

## ğŸ“‹ é˜¶æ®µ1æ€»è§ˆ

### æ ¸å¿ƒç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           APIä¸æ•°æ®å±‚ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰            â”‚
â”‚                                              â”‚
â”‚  ç›®æ ‡1: OKX APIå…¨å­—æ®µå®Œæ•´è·å–               â”‚
â”‚  ç›®æ ‡2: æ•°æ®åº“å…¨å­—æ®µå®Œæ•´å­˜å‚¨                â”‚
â”‚  ç›®æ ‡3: DLLæ¥å£å…¨åŠŸèƒ½å¯¼å‡º                   â”‚
â”‚  ç›®æ ‡4: å®Œæ•´çš„éªŒè¯å·¥å…·                      â”‚
â”‚  ç›®æ ‡5: é«˜åº¦è§£è€¦ã€æ˜“æ‰©å±•                    â”‚
â”‚                                              â”‚
â”‚  éªŒè¯æ ‡å‡†: ä¸€ä¸ªå·¥å…·èƒ½å±•ç¤ºæ‰€æœ‰æ•°æ®ï¼         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸åŒ…å«å†…å®¹ï¼ˆåç»­é˜¶æ®µï¼‰

âŒ ç­–ç•¥å¼•æ“ï¼ˆå¥—åˆ©é€»è¾‘ï¼‰  
âŒ ç›ˆäºè®¡ç®—å™¨  
âŒ å›¾è¡¨é¢æ¿  
âŒ è®¢å•é¢æ¿  
âŒ å¥—åˆ©äº¤æ˜“åŠŸèƒ½  

### åŒ…å«å†…å®¹ï¼ˆæœ¬é˜¶æ®µï¼‰

âœ… **OKX REST API** - å®Œæ•´å°è£…ï¼Œå…¨å­—æ®µæ”¯æŒ  
âœ… **OKX WebSocket** - å®æ—¶æ¨é€ï¼Œå…¨é¢‘é“è®¢é˜…  
âœ… **SQLiteæ•°æ®åº“** - 14å¼ è¡¨ï¼Œ100+å­—æ®µ  
âœ… **DLLå¯¼å‡ºæ¥å£** - 60+ä¸ªå‡½æ•°  
âœ… **APIéªŒè¯å·¥å…·** - å®Œæ•´å±•ç¤ºæ‰€æœ‰æ•°æ®  
âœ… **é…ç½®ç³»ç»Ÿ** - çµæ´»å¯é…ç½®  
âœ… **æ—¥å¿—ç³»ç»Ÿ** - å®Œæ•´æ—¥å¿—è®°å½•  

---

## ğŸ—ï¸ æ¨¡å—æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MT5 éªŒè¯å·¥å…·ï¼ˆEAï¼‰                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ•°æ®å±•ç¤ºé¢æ¿                                      â”‚ â”‚
â”‚  â”‚  - è´¦æˆ·ä¿¡æ¯å±•ç¤ºï¼ˆæ‰€æœ‰å­—æ®µï¼‰                       â”‚ â”‚
â”‚  â”‚  - æŒä»“ä¿¡æ¯å±•ç¤ºï¼ˆæ‰€æœ‰å­—æ®µï¼‰                       â”‚ â”‚
â”‚  â”‚  - è®¢å•ä¿¡æ¯å±•ç¤ºï¼ˆæ‰€æœ‰å­—æ®µï¼‰                       â”‚ â”‚
â”‚  â”‚  - æˆäº¤è®°å½•å±•ç¤ºï¼ˆæ‰€æœ‰å­—æ®µï¼‰                       â”‚ â”‚
â”‚  â”‚  - è´¦å•è®°å½•å±•ç¤ºï¼ˆæ‰€æœ‰å­—æ®µï¼‰                       â”‚ â”‚
â”‚  â”‚  - è¡Œæƒ…æ•°æ®å±•ç¤ºï¼ˆTick/æ·±åº¦/Kçº¿ï¼‰                  â”‚ â”‚
â”‚  â”‚  - èµ„é‡‘è´¹ç‡å±•ç¤º                                    â”‚ â”‚
â”‚  â”‚  - ç³»ç»ŸçŠ¶æ€å±•ç¤º                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• (DLLè°ƒç”¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DLLå¯¼å‡ºå±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  60+ å¯¼å‡ºå‡½æ•°                                      â”‚ â”‚
â”‚  â”‚  - åˆå§‹åŒ–/å…³é—­æ¥å£ï¼ˆ5ä¸ªï¼‰                         â”‚ â”‚
â”‚  â”‚  - è´¦æˆ·æŸ¥è¯¢æ¥å£ï¼ˆ8ä¸ªï¼‰                            â”‚ â”‚
â”‚  â”‚  - æŒä»“æŸ¥è¯¢æ¥å£ï¼ˆ8ä¸ªï¼‰                            â”‚ â”‚
â”‚  â”‚  - è®¢å•æ“ä½œæ¥å£ï¼ˆ10ä¸ªï¼‰                           â”‚ â”‚
â”‚  â”‚  - æˆäº¤æŸ¥è¯¢æ¥å£ï¼ˆ5ä¸ªï¼‰                            â”‚ â”‚
â”‚  â”‚  - è´¦å•æŸ¥è¯¢æ¥å£ï¼ˆ5ä¸ªï¼‰                            â”‚ â”‚
â”‚  â”‚  - è¡Œæƒ…æŸ¥è¯¢æ¥å£ï¼ˆ8ä¸ªï¼‰                            â”‚ â”‚
â”‚  â”‚  - æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ï¼ˆ8ä¸ªï¼‰                          â”‚ â”‚
â”‚  â”‚  - ç³»ç»Ÿç®¡ç†æ¥å£ï¼ˆ5ä¸ªï¼‰                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆC++ï¼‰                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OKXAPIClient â”‚  â”‚WebSocketClientâ”‚  â”‚ DataProvider â”‚ â”‚
â”‚  â”‚ - REST API   â”‚  â”‚ - å…¬å…±é¢‘é“   â”‚  â”‚ - æ•°æ®èšåˆ   â”‚ â”‚
â”‚  â”‚ - ç­¾åç®—æ³•   â”‚  â”‚ - ç§æœ‰é¢‘é“   â”‚  â”‚ - ç¼“å­˜ç®¡ç†   â”‚ â”‚
â”‚  â”‚ - é”™è¯¯å¤„ç†   â”‚  â”‚ - è‡ªåŠ¨é‡è¿   â”‚  â”‚ - åŒæ­¥é€»è¾‘   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â†•                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           DatabaseManagerï¼ˆSQLiteï¼‰               â”‚  â”‚
â”‚  â”‚  - 14å¼ æ•°æ®è¡¨ï¼ˆ100+å­—æ®µï¼‰                        â”‚  â”‚
â”‚  â”‚  - CRUDæ“ä½œ                                       â”‚  â”‚
â”‚  â”‚  - åŸå§‹SQLæŸ¥è¯¢æ”¯æŒ                                â”‚  â”‚
â”‚  â”‚  - è‡ªåŠ¨å¤‡ä»½                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é…ç½®ä¸å·¥å…·å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ConfigManagerâ”‚  â”‚LogManager  â”‚  â”‚  FieldSelector   â”‚ â”‚
â”‚  â”‚- JSONé…ç½®  â”‚  â”‚- åˆ†çº§æ—¥å¿—  â”‚  â”‚- å­—æ®µè¿‡æ»¤       â”‚ â”‚
â”‚  â”‚- çƒ­é‡è½½    â”‚  â”‚- æ–‡ä»¶æ»šåŠ¨  â”‚  â”‚- æŒ‰éœ€å¯ç”¨å­—æ®µ   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨ç³»ç»Ÿ                              â”‚
â”‚              OKXäº¤æ˜“æ‰€ REST API + WebSocket             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ è¯¦ç»†æ¨¡å—æ¸…å•

### æ¨¡å—M1ï¼šæ•°æ®ç»“æ„å®šä¹‰ âœ…ï¼ˆå·²å®Œæˆï¼‰

**çŠ¶æ€**: å·²å®ŒæˆåŸºç¡€ç»“æ„  
**éœ€è¦è¡¥å……**: OKX APIå…¨å­—æ®µç»“æ„

#### æ–°å¢å†…å®¹

```cpp
// okx_types.h - OKX APIå®Œæ•´å­—æ®µå®šä¹‰

// è´¦æˆ·é…ç½®
struct AccountConfig {
    string uid;              // ç”¨æˆ·ID
    string acct_lv;          // è´¦æˆ·å±‚çº§ 1:ç®€å• 2:å•å¸ç§ 3:è·¨å¸ç§ 4:ç»„åˆä¿è¯é‡‘
    string pos_mode;         // æŒä»“æ¨¡å¼ long_short_modeå‡€æŒä»“ net_modeåŒå‘æŒä»“
    bool auto_loan;          // æ˜¯å¦è‡ªåŠ¨å€Ÿå¸
    string greeks_type;      // å¸Œè…Šå­—æ¯å±•ç¤ºæ–¹å¼
    string level;            // è´¦æˆ·ç­‰çº§
    string level_tmp;        // ä¸´æ—¶ä½“éªŒçš„è´¦æˆ·ç­‰çº§
    string ct_iso_mode;      // åˆçº¦é€ä»“ä¿è¯é‡‘åˆ’è½¬æ¨¡å¼
    string mg_iso_mode;      // å¸å¸æ æ†é€ä»“ä¿è¯é‡‘åˆ’è½¬æ¨¡å¼
    string spot_offset_type; // ç°è´§å¯¹å†²æ¨¡å¼
    string role_type;        // è§’è‰²ç±»å‹ 0:æ™®é€šç”¨æˆ· 1:åšå¸‚å•†ç­‰
    string trade_role;       // äº¤æ˜“è§’è‰²
    // ... æ›´å¤šå­—æ®µ
};

// è´¦æˆ·ä½™é¢è¯¦ç»†ä¿¡æ¯
struct AccountBalance {
    string ccy;              // å¸ç§
    string eq;               // å¸ç§æ€»æƒç›Š
    string cash_bal;         // å¸ç§ä½™é¢
    string upl;              // æœªå®ç°ç›ˆäº
    string avail_eq;         // å¯ç”¨ä¿è¯é‡‘
    string dis_eq;           // ç¾å…ƒå±‚é¢å¸ç§æŠ˜ç®—æƒç›Š
    string avail_bal;        // å¯ç”¨ä½™é¢
    string frozen_bal;       // å†»ç»“ä½™é¢
    string ord_frozen;       // æŒ‚å•å†»ç»“æ•°é‡
    string liab;             // è´Ÿå€ºé¢
    string upl_liab;         // æœªå®ç°ç›ˆäºè´Ÿå€ºé¢
    string cross_liab;       // å…¨ä»“è´Ÿå€ºé¢
    string iso_liab;         // é€ä»“è´Ÿå€ºé¢
    string margin_ratio;     // ä¿è¯é‡‘ç‡
    string interest;         // åˆ©æ¯
    string twap;             // å½“å‰è´Ÿå€ºå¸ç§è§¦å‘ç³»ç»Ÿè‡ªåŠ¨æ¢å¸çš„é£é™©
    string max_loan;         // å¸ç§æœ€å¤§å¯å€Ÿ
    string eq_usd;           // å¸ç§æƒç›Šç¾å…ƒä»·å€¼
    string notional_lever;   // æ æ†å€æ•°
    string stgy_eq;          // ç­–ç•¥æƒç›Š
    string iso_upl;          // é€ä»“æœªå®ç°ç›ˆäº
    string spot_in_use_amt;  // ç°è´§å¯¹å†²å ç”¨æ•°é‡
    string spot_iso_upl;     // ç°è´§å¯¹å†²å ç”¨éƒ¨åˆ†çš„æœªå®ç°ç›ˆäº
    // ... æ›´å¤šå­—æ®µ
};

// æŒä»“è¯¦ç»†ä¿¡æ¯ï¼ˆå…¨å­—æ®µï¼‰
struct PositionDetail {
    string inst_type;        // äº§å“ç±»å‹ MARGIN SWAP FUTURES OPTION
    string inst_id;          // äº§å“ID
    string pos_id;           // æŒä»“ID
    string pos_side;         // æŒä»“æ–¹å‘ long short net
    string pos;              // æŒä»“æ•°é‡
    string avail_pos;        // å¯å¹³ä»“æ•°é‡
    string avg_px;           // å¼€ä»“å¹³å‡ä»·
    string mark_px;          // æ ‡è®°ä»·æ ¼
    string upl;              // æœªå®ç°æ”¶ç›Š
    string upl_ratio;        // æœªå®ç°æ”¶ç›Šç‡
    string upl_last_px;      // ä»¥æœ€æ–°æˆäº¤ä»·è®¡ç®—çš„æœªå®ç°æ”¶ç›Š
    string upl_ratio_last_px;// ä»¥æœ€æ–°æˆäº¤ä»·è®¡ç®—çš„æœªå®ç°æ”¶ç›Šç‡
    string inst_type_px;     // äº§å“ç±»å‹ä»·æ ¼
    string notional_usd;     // ä»¥ç¾å…ƒä»·å€¼ä¸ºå•ä½çš„æŒä»“æ•°é‡
    string adl;              // ä¿¡å·åŒº 1,2,3,4,5
    string imr;              // åˆå§‹ä¿è¯é‡‘
    string margin;           // ä¿è¯é‡‘ä½™é¢
    string margin_ratio;     // ä¿è¯é‡‘ç‡
    string mmr;              // ç»´æŒä¿è¯é‡‘
    string liab;             // è´Ÿå€ºé¢
    string liab_ccy;         // è´Ÿå€ºå¸ç§
    string interest;         // åˆ©æ¯
    string trade_id;         // æœ€æ–°æˆäº¤ID
    string opt_val;          // æœŸæƒå¸‚å€¼
    string pending_close_ord_liab_val; // å¹³ä»“æŒ‚å•çš„è´Ÿå€ºé¢
    string notional_ccy;     // äº¤æ˜“è´§å¸æŒä»“æ•°é‡
    string liq_px;           // é¢„ä¼°å¼ºå¹³ä»·
    string lever;            // æ æ†å€æ•°
    string delta_bs;         // delta ç”¨äºæœŸæƒ
    string delta_pa;         // delta PA ç”¨äºæœŸæƒ
    string gamma_bs;         // gamma ç”¨äºæœŸæƒ
    string gamma_pa;         // gamma PA ç”¨äºæœŸæƒ
    string theta_bs;         // theta ç”¨äºæœŸæƒ
    string theta_pa;         // theta PA ç”¨äºæœŸæƒ
    string vega_bs;          // vega ç”¨äºæœŸæƒ
    string vega_pa;          // vega PA ç”¨äºæœŸæƒ
    string spot_in_use_amt;  // ç°è´§å¯¹å†²å ç”¨æ•°é‡
    string spot_in_use_ccy;  // ç°è´§å¯¹å†²å ç”¨å¸ç§
    string clSpotInUseAmt;   // ç”¨æˆ·è‡ªå®šä¹‰ç°è´§å¯¹å†²å ç”¨æ•°é‡
    string max_spot_in_use_amt; // ç°è´§å¯¹å†²å ç”¨æ•°é‡ä¸Šé™
    string biz_ref_id;       // ä¸šåŠ¡çº¿ID
    string biz_ref_type;     // ä¸šåŠ¡çº¿ç±»å‹
    string base_bal;         // äº¤æ˜“è´§å¸ä½™é¢
    string quote_bal;        // è®¡ä»·è´§å¸ä½™é¢
    string base_borrowed;    // äº¤æ˜“è´§å¸å·²å€Ÿ
    string base_interest;    // äº¤æ˜“è´§å¸åˆ©æ¯
    string quote_borrowed;   // è®¡ä»·è´§å¸å·²å€Ÿ
    string quote_interest;   // è®¡ä»·è´§å¸åˆ©æ¯
    string pos_ccy;          // ç›ˆäºç»“ç®—å¸ç§
    string fee;              // ç´¯è®¡æ‰‹ç»­è´¹
    string funding_fee;      // ç´¯è®¡èµ„é‡‘è´¹ç”¨
    string liq_penalty;      // ç´¯è®¡å¼ºå¹³ç½šé‡‘
    string realized_pnl;     // å·²å®ç°æ”¶ç›Š
    string pnl;              // æ”¶ç›Š
    string close_order_algo; // å¹³ä»“ç­–ç•¥å§”æ‰˜è®¢å•
    string c_time;           // æŒä»“åˆ›å»ºæ—¶é—´
    string u_time;           // æŒä»“æ›´æ–°æ—¶é—´
    string px_usd;           // ç¾å…ƒä»·æ ¼
    
    // è‡ªå®šä¹‰æ‰©å±•å­—æ®µ
    Timestamp create_time_ms;
    Timestamp update_time_ms;
    double upl_numeric;
    double pnl_numeric;
    double margin_ratio_numeric;
};

// è®¢å•è¯¦ç»†ä¿¡æ¯ï¼ˆå…¨å­—æ®µï¼‰
struct OrderDetail {
    string inst_type;        // äº§å“ç±»å‹
    string inst_id;          // äº§å“ID
    string ccy;              // ä¿è¯é‡‘å¸ç§
    string ord_id;           // è®¢å•ID
    string cl_ord_id;        // å®¢æˆ·è‡ªå®šä¹‰è®¢å•ID
    string tag;              // è®¢å•æ ‡ç­¾
    string px;               // å§”æ‰˜ä»·æ ¼
    string sz;               // å§”æ‰˜æ•°é‡
    string pnl;              // æ”¶ç›Š
    string ord_type;         // è®¢å•ç±»å‹ market/limit/post_onlyç­‰
    string side;             // è®¢å•æ–¹å‘ buy/sell
    string pos_side;         // æŒä»“æ–¹å‘
    string td_mode;          // äº¤æ˜“æ¨¡å¼ isolated/cross/cash
    string acc_fill_sz;      // ç´¯è®¡æˆäº¤æ•°é‡
    string fill_px;          // æœ€æ–°æˆäº¤ä»·æ ¼
    string trade_id;         // æœ€æ–°æˆäº¤ID
    string fill_sz;          // æœ€æ–°æˆäº¤æ•°é‡
    string fill_time;        // æœ€æ–°æˆäº¤æ—¶é—´
    string state;            // è®¢å•çŠ¶æ€
    string avg_px;           // æˆäº¤å‡ä»·
    string lever;            // æ æ†å€æ•°
    string tp_trigger_px;    // æ­¢ç›ˆè§¦å‘ä»·
    string tp_trigger_px_type; // æ­¢ç›ˆè§¦å‘ä»·ç±»å‹
    string tp_ord_px;        // æ­¢ç›ˆå§”æ‰˜ä»·
    string sl_trigger_px;    // æ­¢æŸè§¦å‘ä»·
    string sl_trigger_px_type; // æ­¢æŸè§¦å‘ä»·ç±»å‹
    string sl_ord_px;        // æ­¢æŸå§”æ‰˜ä»·
    string fee_ccy;          // äº¤æ˜“æ‰‹ç»­è´¹å¸ç§
    string fee;              // è®¢å•äº¤æ˜“æ‰‹ç»­è´¹
    string rebate_ccy;       // è¿”ä½£å¸ç§
    string rebate;           // è¿”ä½£é‡‘é¢
    string tgt_ccy;          // ç›®æ ‡å¸ç§
    string category;         // è®¢å•ç§ç±»
    string u_time;           // è®¢å•æ›´æ–°æ—¶é—´
    string c_time;           // è®¢å•åˆ›å»ºæ—¶é—´
    string req_id;           // ç”¨æˆ·è¯·æ±‚ID
    string amend_result;     // ä¿®æ”¹è®¢å•çš„ç»“æœ
    string code;             // é”™è¯¯ç 
    string msg;              // é”™è¯¯ä¿¡æ¯
    string reduce_only;      // æ˜¯å¦åªå‡ä»“
    string quick_mgn_type;   // ä¸€é”®å€Ÿå¸ç±»å‹
    string algo_cl_ord_id;   // å®¢æˆ·è‡ªå®šä¹‰ç­–ç•¥è®¢å•ID
    string algo_id;          // ç­–ç•¥è®¢å•ID
    string attach_algo_ords; // é™„å¸¦æ­¢ç›ˆæ­¢æŸä¿¡æ¯
    string linked_ord;       // ä¸‹å•é™„å¸¦æ­¢ç›ˆæ­¢æŸæ—¶ï¼Œå®¢æˆ·è‡ªå®šä¹‰çš„ç­–ç•¥è®¢å•ID
    string stp_id;           // è‡ªæˆäº¤ä¿æŠ¤ID
    string stp_mode;         // è‡ªæˆäº¤ä¿æŠ¤æ¨¡å¼
    // ... æ›´å¤šå­—æ®µ
    
    // è‡ªå®šä¹‰æ‰©å±•å­—æ®µ
    Timestamp create_time_ms;
    Timestamp update_time_ms;
    Timestamp fill_time_ms;
    double sz_numeric;
    double px_numeric;
    double avg_px_numeric;
    double fee_numeric;
    double pnl_numeric;
};

// æˆäº¤æ˜ç»†ï¼ˆå…¨å­—æ®µï¼‰
struct TradeDetail {
    string inst_type;        // äº§å“ç±»å‹
    string inst_id;          // äº§å“ID
    string trade_id;         // æˆäº¤ID
    string ord_id;           // è®¢å•ID
    string cl_ord_id;        // å®¢æˆ·è‡ªå®šä¹‰è®¢å•ID
    string bill_id;          // è´¦å•ID
    string tag;              // è®¢å•æ ‡ç­¾
    string fill_px;          // æˆäº¤ä»·æ ¼
    string fill_sz;          // æˆäº¤æ•°é‡
    string side;             // è®¢å•æ–¹å‘
    string pos_side;         // æŒä»“æ–¹å‘
    string exec_type;        // æµåŠ¨æ€§æ–¹å‘ T taker M maker
    string fee_ccy;          // äº¤æ˜“æ‰‹ç»­è´¹å¸ç§
    string fee;              // æ‰‹ç»­è´¹é‡‘é¢
    string ts;               // æˆäº¤æ—¶é—´
    
    // è‡ªå®šä¹‰æ‰©å±•å­—æ®µ
    Timestamp fill_time_ms;
    double fill_px_numeric;
    double fill_sz_numeric;
    double fee_numeric;
};

// è´¦å•è®°å½•ï¼ˆå…¨å­—æ®µï¼‰
struct BillDetail {
    string inst_type;        // äº§å“ç±»å‹
    string inst_id;          // äº§å“ID
    string ccy;              // è´¦å•å¸ç§
    string bill_id;          // è´¦å•ID
    string type;             // è´¦å•ç±»å‹
    string sub_type;         // è´¦å•å­ç±»å‹
    string ts;               // è´¦å•åˆ›å»ºæ—¶é—´
    string bal_chg;          // è´¦æˆ·å±‚é¢çš„ä½™é¢å˜åŠ¨æ•°é‡
    string pos_bal_chg;      // ä»“ä½å±‚é¢çš„ä½™é¢å˜åŠ¨æ•°é‡
    string bal;              // è´¦æˆ·å±‚é¢çš„ä½™é¢æ•°é‡
    string pos_bal;          // ä»“ä½å±‚é¢çš„ä½™é¢æ•°é‡
    string sz;               // æ•°é‡
    string px;               // ä»·æ ¼
    string pnl;              // æ”¶ç›Š
    string fee;              // æ‰‹ç»­è´¹
    string ord_id;           // è®¢å•ID
    string fill_mark_vol;    // æˆäº¤æ—¶æ ‡è®°æ³¢åŠ¨ç‡ï¼ˆä»…é€‚ç”¨äºæœŸæƒï¼‰
    string fill_forward_px;  // æˆäº¤æ—¶è¿œæœŸä»·æ ¼ï¼ˆä»…é€‚ç”¨äºæœŸæƒï¼‰
    string fill_mark_px;     // æˆäº¤æ—¶æ ‡è®°ä»·æ ¼
    string fill_px;          // æˆäº¤ä»·æ ¼
    string fill_time;        // æˆäº¤æ—¶é—´
    string from;             // è½¬å‡ºè´¦æˆ·
    string to;               // è½¬å…¥è´¦æˆ·
    string notes;            // å¤‡æ³¨
    string interest;         // åˆ©æ¯
    string trade_id;         // æˆäº¤ID
    // ... æ›´å¤šå­—æ®µ
    
    // è‡ªå®šä¹‰æ‰©å±•å­—æ®µ
    Timestamp timestamp_ms;
    double bal_chg_numeric;
    double fee_numeric;
    double pnl_numeric;
};
```

---

### æ¨¡å—M2ï¼šOKX REST APIå®Œæ•´å°è£…

**ç›®çš„**: å°è£…æ‰€æœ‰OKX REST APIï¼Œæ”¯æŒå…¨å­—æ®µè·å–

#### æ ¸å¿ƒç±»è®¾è®¡

```cpp
// okx_api_client.h
class OKXAPIClient {
public:
    // åˆå§‹åŒ–
    bool Initialize(const string& api_key, 
                    const string& secret_key,
                    const string& passphrase,
                    bool is_simulation = false);
    
    // ==================== è´¦æˆ· API ====================
    
    // è·å–è´¦æˆ·é…ç½®
    Result<AccountConfig> GetAccountConfig();
    
    // è·å–è´¦æˆ·ä½™é¢ï¼ˆå…¨å­—æ®µï¼‰
    Result<vector<AccountBalance>> GetBalance(const string& ccy = "");
    
    // è·å–æŒä»“ä¿¡æ¯ï¼ˆå…¨å­—æ®µï¼‰
    Result<vector<PositionDetail>> GetPositions(
        const string& inst_type = "",
        const string& inst_id = ""
    );
    
    // è·å–æŒä»“å†å²
    Result<vector<PositionDetail>> GetPositionsHistory(
        const string& inst_type = "",
        const string& inst_id = "",
        const string& mg_mode = "",
        const string& type = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–è´¦æˆ·å’ŒæŒä»“é£é™©
    Result<json> GetAccountPositionRisk(const string& inst_type = "");
    
    // è·å–è´¦å•æµæ°´ï¼ˆå…¨å­—æ®µï¼‰
    Result<vector<BillDetail>> GetBills(
        const string& inst_type = "",
        const string& ccy = "",
        const string& mg_mode = "",
        const string& ct_type = "",
        const string& type = "",
        const string& sub_type = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–è´¦å•æµæ°´ï¼ˆ3ä¸ªæœˆå†…ï¼‰
    Result<vector<BillDetail>> GetBillsArchive(
        const string& inst_type = "",
        const string& ccy = "",
        const string& mg_mode = "",
        const string& ct_type = "",
        const string& type = "",
        const string& sub_type = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== äº¤æ˜“ API ====================
    
    // ä¸‹å•
    Result<OrderDetail> PlaceOrder(const OrderRequest& request);
    
    // æ‰¹é‡ä¸‹å•
    Result<vector<OrderDetail>> PlaceMultipleOrders(
        const vector<OrderRequest>& requests
    );
    
    // æ’¤å•
    Result<OrderDetail> CancelOrder(
        const string& inst_id,
        const string& ord_id = "",
        const string& cl_ord_id = ""
    );
    
    // æ‰¹é‡æ’¤å•
    Result<vector<OrderDetail>> CancelMultipleOrders(
        const vector<CancelRequest>& requests
    );
    
    // ä¿®æ”¹è®¢å•
    Result<OrderDetail> AmendOrder(const AmendRequest& request);
    
    // æ‰¹é‡ä¿®æ”¹è®¢å•
    Result<vector<OrderDetail>> AmendMultipleOrders(
        const vector<AmendRequest>& requests
    );
    
    // å¸‚ä»·å¹³ä»“
    Result<OrderDetail> ClosePosition(
        const string& inst_id,
        const string& mg_mode,
        const string& pos_side = "",
        const string& ccy = "",
        bool auto_cancel = false
    );
    
    // è·å–è®¢å•ä¿¡æ¯ï¼ˆå…¨å­—æ®µï¼‰
    Result<OrderDetail> GetOrder(
        const string& inst_id,
        const string& ord_id = "",
        const string& cl_ord_id = ""
    );
    
    // è·å–æœªæˆäº¤è®¢å•åˆ—è¡¨
    Result<vector<OrderDetail>> GetPendingOrders(
        const string& inst_type = "",
        const string& inst_id = "",
        const string& uly = "",
        const string& ord_type = "",
        const string& state = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–å†å²è®¢å•è®°å½•ï¼ˆè¿‘7å¤©ï¼‰
    Result<vector<OrderDetail>> GetOrderHistory(
        const string& inst_type,
        const string& inst_id = "",
        const string& uly = "",
        const string& ord_type = "",
        const string& state = "",
        const string& category = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–å†å²è®¢å•è®°å½•ï¼ˆè¿‘3ä¸ªæœˆï¼‰
    Result<vector<OrderDetail>> GetOrderHistoryArchive(
        const string& inst_type,
        const string& inst_id = "",
        const string& uly = "",
        const string& ord_type = "",
        const string& state = "",
        const string& category = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æˆäº¤æ˜ç»†ï¼ˆå…¨å­—æ®µï¼‰
    Result<vector<TradeDetail>> GetFills(
        const string& inst_type = "",
        const string& inst_id = "",
        const string& ord_id = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æˆäº¤æ˜ç»†ï¼ˆè¿‘3ä¸ªæœˆï¼‰
    Result<vector<TradeDetail>> GetFillsHistory(
        const string& inst_type,
        const string& inst_id = "",
        const string& ord_id = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== è¡Œæƒ… API ====================
    
    // è·å–äº§å“ä¿¡æ¯
    Result<vector<InstrumentInfo>> GetInstruments(
        const string& inst_type,
        const string& uly = "",
        const string& inst_id = ""
    );
    
    // è·å–äº¤å‰²å’Œè¡Œæƒè®°å½•
    Result<json> GetDeliveryExerciseHistory(
        const string& inst_type,
        const string& uly = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æŒä»“æ€»é‡
    Result<json> GetOpenInterest(const string& inst_type, const string& uly = "");
    
    // è·å–èµ„é‡‘è´¹ç‡
    Result<vector<FundingRate>> GetFundingRate(const string& inst_id);
    
    // è·å–èµ„é‡‘è´¹ç‡å†å²
    Result<vector<FundingRate>> GetFundingRateHistory(
        const string& inst_id,
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–é™ä»·
    Result<json> GetPriceLimit(const string& inst_id);
    
    // è·å–æœŸæƒå®šä»·
    Result<json> GetOptionSummary(
        const string& uly,
        const string& exp_time = ""
    );
    
    // è·å–é¢„ä¼°äº¤å‰²/è¡Œæƒä»·æ ¼
    Result<json> GetEstimatedPrice(const string& inst_id);
    
    // è·å–æŠ˜ä»·ç‡
    Result<json> GetDiscountRateInterestFreeQuota(
        const string& ccy = "",
        int discount_lv = 1
    );
    
    // è·å–ç³»ç»Ÿæ—¶é—´
    Result<Timestamp> GetSystemTime();
    
    // è·å–æ ‡è®°ä»·æ ¼
    Result<json> GetMarkPrice(
        const string& inst_type,
        const string& uly = "",
        const string& inst_id = ""
    );
    
    // è·å–æŒ‡æ•°è¡Œæƒ…
    Result<json> GetIndexTickers(
        const string& quote_ccy = "",
        const string& inst_id = ""
    );
    
    // è·å–æŒ‡æ•°Kçº¿
    Result<vector<Candle>> GetIndexCandles(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æŒ‡æ•°å†å²Kçº¿
    Result<vector<Candle>> GetIndexCandlesHistory(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æ ‡è®°ä»·æ ¼Kçº¿
    Result<vector<Candle>> GetMarkPriceCandles(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–æ ‡è®°ä»·æ ¼å†å²Kçº¿
    Result<vector<Candle>> GetMarkPriceCandlesHistory(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–äº¤æ˜“äº§å“å…¬å…±æˆäº¤æ•°æ®
    Result<vector<PublicTrade>> GetPublicTrades(
        const string& inst_id,
        int limit = 100
    );
    
    // è·å–äº¤æ˜“äº§å“å†å²å…¬å…±æˆäº¤æ•°æ®
    Result<vector<PublicTrade>> GetPublicTradesHistory(
        const string& inst_id,
        const string& type = "1",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // è·å–24å°æ—¶æˆäº¤é‡
    Result<json> Get24HVolume();
    
    // ==================== WebSocketç›¸å…³ï¼ˆç”¨äºRESTè¡¥å……ï¼‰====================
    
    // Ticker
    Result<Ticker> GetTicker(const string& inst_id);
    
    // æ·±åº¦
    Result<Depth> GetOrderBook(const string& inst_id, int sz = 5);
    
    // Kçº¿
    Result<vector<Candle>> GetCandles(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // Kçº¿å†å²ï¼ˆæœ€è¿‘3ä¸ªæœˆï¼‰
    Result<vector<Candle>> GetCandlesHistory(
        const string& inst_id,
        const string& bar = "1m",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );

private:
    // ç­¾åç®—æ³•
    string GenerateSignature(
        const string& timestamp,
        const string& method,
        const string& request_path,
        const string& body
    );
    
    // HTTPè¯·æ±‚
    Result<json> HttpRequest(
        const string& method,
        const string& endpoint,
        const json& params = json(),
        bool need_sign = true
    );
    
    // APIå¯†é’¥
    string api_key_;
    string secret_key_;
    string passphrase_;
    bool is_simulation_;
    
    // Base URL
    string base_url_;
    
    // é™æµå™¨
    RateLimiter rate_limiter_;
    
    // HTTPå®¢æˆ·ç«¯
    unique_ptr<HttpClient> http_client_;
};
```

#### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **å…¨å­—æ®µæ”¯æŒ**: æ‰€æœ‰APIè¿”å›çš„å­—æ®µéƒ½å®Œæ•´æ˜ å°„
2. **ç±»å‹å®‰å…¨**: ä½¿ç”¨å¼ºç±»å‹è€Œä¸æ˜¯è£¸JSON
3. **æ˜“äºæ‰©å±•**: æ–°å¢APIåªéœ€æ·»åŠ ä¸€ä¸ªå‡½æ•°
4. **é”™è¯¯å¤„ç†**: Result<T>ç»Ÿä¸€é”™è¯¯å¤„ç†
5. **å¹³å°æ— å…³**: æ›´æ¢å¹³å°åªéœ€å®ç°ç›¸åŒæ¥å£

---

### æ¨¡å—M3ï¼šWebSocketå®¢æˆ·ç«¯

**ç›®çš„**: å®æ—¶æ¥æ”¶OKXæ¨é€æ•°æ®

#### æ ¸å¿ƒç±»è®¾è®¡

```cpp
// websocket_client.h
class WebSocketClient {
public:
    // åˆå§‹åŒ–
    bool Initialize(const string& url, bool is_private = false);
    
    // ç™»å½•ï¼ˆç§æœ‰é¢‘é“éœ€è¦ï¼‰
    bool Login(const string& api_key,
               const string& secret_key,
               const string& passphrase);
    
    // è®¢é˜…å…¬å…±é¢‘é“
    bool SubscribeTicker(const string& inst_id,
                         function<void(const Ticker&)> callback);
    
    bool SubscribeOrderBook(const string& inst_id,
                            const string& channel, // books/books5/bbo-tbtç­‰
                            function<void(const Depth&)> callback);
    
    bool SubscribeCandles(const string& inst_id,
                          const string& bar,
                          function<void(const Candle&)> callback);
    
    bool SubscribeTrades(const string& inst_id,
                         function<void(const PublicTrade&)> callback);
    
    bool SubscribeFundingRate(const string& inst_id,
                              function<void(const FundingRate&)> callback);
    
    bool SubscribeIndexTickers(const string& inst_id,
                               function<void(const json&)> callback);
    
    bool SubscribeMarkPrice(const string& inst_id,
                            function<void(const json&)> callback);
    
    // è®¢é˜…ç§æœ‰é¢‘é“
    bool SubscribeAccount(function<void(const vector<AccountBalance>&)> callback);
    
    bool SubscribePositions(const string& inst_type,
                            const string& inst_id,
                            function<void(const vector<PositionDetail>&)> callback);
    
    bool SubscribeOrders(const string& inst_type,
                         const string& inst_id,
                         function<void(const vector<OrderDetail>&)> callback);
    
    bool SubscribeAlgoOrders(const string& inst_type,
                             const string& inst_id,
                             function<void(const json&)> callback);
    
    // å–æ¶ˆè®¢é˜…
    bool Unsubscribe(const string& channel, const string& inst_id = "");
    
    bool UnsubscribeAll();
    
    // è¿æ¥ç®¡ç†
    bool Connect();
    bool Disconnect();
    bool IsConnected() const;
    
    // è‡ªåŠ¨é‡è¿
    void EnableAutoReconnect(bool enable, int delay_seconds = 5);
    
    // å¿ƒè·³
    void EnablePing(bool enable, int interval_seconds = 20);
    
    // é”™è¯¯å›è°ƒ
    void SetErrorCallback(function<void(const string&)> callback);
    
    // è¿æ¥çŠ¶æ€å›è°ƒ
    void SetConnectionCallback(function<void(bool)> callback);

private:
    // æ¶ˆæ¯å¤„ç†
    void OnMessage(const string& message);
    
    // å¿ƒè·³
    void SendPing();
    
    // é‡è¿
    void Reconnect();
    
    // WebSocketè¿æ¥
    unique_ptr<WebSocket> ws_;
    
    // è®¢é˜…ç®¡ç†
    map<string, vector<function<void(const json&)>>> subscribers_;
    
    // è®¤è¯ä¿¡æ¯
    string api_key_;
    string secret_key_;
    string passphrase_;
    bool is_private_;
    bool is_logged_in_;
    
    // é‡è¿æ§åˆ¶
    bool auto_reconnect_;
    int reconnect_delay_;
    int reconnect_attempts_;
    
    // å¿ƒè·³æ§åˆ¶
    bool enable_ping_;
    int ping_interval_;
    Timestamp last_ping_time_;
    
    // å›è°ƒ
    function<void(const string&)> error_callback_;
    function<void(bool)> connection_callback_;
    
    // çº¿ç¨‹å®‰å…¨
    mutex mutex_;
    thread ping_thread_;
};
```

---

### æ¨¡å—M4ï¼šSQLiteæ•°æ®åº“ï¼ˆ14å¼ è¡¨ï¼Œ100+å­—æ®µï¼‰

**ç›®çš„**: å®Œæ•´å­˜å‚¨æ‰€æœ‰OKXæ•°æ®

#### æ•°æ®åº“Schema

```sql
-- 1. è´¦æˆ·é…ç½®è¡¨
CREATE TABLE account_config (
    uid TEXT PRIMARY KEY,
    acct_lv TEXT,
    pos_mode TEXT,
    auto_loan INTEGER,
    greeks_type TEXT,
    level TEXT,
    level_tmp TEXT,
    ct_iso_mode TEXT,
    mg_iso_mode TEXT,
    spot_offset_type TEXT,
    role_type TEXT,
    trade_role TEXT,
    update_time INTEGER
);

-- 2. è´¦æˆ·ä½™é¢è¡¨
CREATE TABLE account_balance (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    ccy TEXT NOT NULL,
    eq TEXT,
    cash_bal TEXT,
    upl TEXT,
    avail_eq TEXT,
    dis_eq TEXT,
    avail_bal TEXT,
    frozen_bal TEXT,
    ord_frozen TEXT,
    liab TEXT,
    upl_liab TEXT,
    cross_liab TEXT,
    iso_liab TEXT,
    margin_ratio TEXT,
    interest TEXT,
    twap TEXT,
    max_loan TEXT,
    eq_usd TEXT,
    notional_lever TEXT,
    stgy_eq TEXT,
    iso_upl TEXT,
    spot_in_use_amt TEXT,
    spot_iso_upl TEXT,
    update_time INTEGER,
    UNIQUE(ccy, update_time)
);

-- 3. æŒä»“è¡¨ï¼ˆå…¨å­—æ®µï¼‰
CREATE TABLE positions (
    pos_id TEXT PRIMARY KEY,
    inst_type TEXT,
    inst_id TEXT,
    pos_side TEXT,
    pos TEXT,
    avail_pos TEXT,
    avg_px TEXT,
    mark_px TEXT,
    upl TEXT,
    upl_ratio TEXT,
    upl_last_px TEXT,
    upl_ratio_last_px TEXT,
    inst_type_px TEXT,
    notional_usd TEXT,
    adl TEXT,
    imr TEXT,
    margin TEXT,
    margin_ratio TEXT,
    mmr TEXT,
    liab TEXT,
    liab_ccy TEXT,
    interest TEXT,
    trade_id TEXT,
    opt_val TEXT,
    pending_close_ord_liab_val TEXT,
    notional_ccy TEXT,
    liq_px TEXT,
    lever TEXT,
    delta_bs TEXT,
    delta_pa TEXT,
    gamma_bs TEXT,
    gamma_pa TEXT,
    theta_bs TEXT,
    theta_pa TEXT,
    vega_bs TEXT,
    vega_pa TEXT,
    spot_in_use_amt TEXT,
    spot_in_use_ccy TEXT,
    cl_spot_in_use_amt TEXT,
    max_spot_in_use_amt TEXT,
    biz_ref_id TEXT,
    biz_ref_type TEXT,
    base_bal TEXT,
    quote_bal TEXT,
    base_borrowed TEXT,
    base_interest TEXT,
    quote_borrowed TEXT,
    quote_interest TEXT,
    pos_ccy TEXT,
    fee TEXT,
    funding_fee TEXT,
    liq_penalty TEXT,
    realized_pnl TEXT,
    pnl TEXT,
    close_order_algo TEXT,
    c_time TEXT,
    u_time TEXT,
    px_usd TEXT,
    create_time_ms INTEGER,
    update_time_ms INTEGER
);

-- 4. è®¢å•è¡¨ï¼ˆå…¨å­—æ®µï¼‰
CREATE TABLE orders (
    ord_id TEXT PRIMARY KEY,
    inst_type TEXT,
    inst_id TEXT,
    ccy TEXT,
    cl_ord_id TEXT,
    tag TEXT,
    px TEXT,
    sz TEXT,
    pnl TEXT,
    ord_type TEXT,
    side TEXT,
    pos_side TEXT,
    td_mode TEXT,
    acc_fill_sz TEXT,
    fill_px TEXT,
    trade_id TEXT,
    fill_sz TEXT,
    fill_time TEXT,
    state TEXT,
    avg_px TEXT,
    lever TEXT,
    tp_trigger_px TEXT,
    tp_trigger_px_type TEXT,
    tp_ord_px TEXT,
    sl_trigger_px TEXT,
    sl_trigger_px_type TEXT,
    sl_ord_px TEXT,
    fee_ccy TEXT,
    fee TEXT,
    rebate_ccy TEXT,
    rebate TEXT,
    tgt_ccy TEXT,
    category TEXT,
    u_time TEXT,
    c_time TEXT,
    req_id TEXT,
    amend_result TEXT,
    code TEXT,
    msg TEXT,
    reduce_only TEXT,
    quick_mgn_type TEXT,
    algo_cl_ord_id TEXT,
    algo_id TEXT,
    attach_algo_ords TEXT,
    linked_ord TEXT,
    stp_id TEXT,
    stp_mode TEXT,
    create_time_ms INTEGER,
    update_time_ms INTEGER,
    fill_time_ms INTEGER
);
CREATE INDEX idx_orders_inst_id ON orders(inst_id);
CREATE INDEX idx_orders_state ON orders(state);
CREATE INDEX idx_orders_create_time ON orders(create_time_ms);

-- 5. æˆäº¤è®°å½•è¡¨
CREATE TABLE trades (
    trade_id TEXT PRIMARY KEY,
    inst_type TEXT,
    inst_id TEXT,
    ord_id TEXT,
    cl_ord_id TEXT,
    bill_id TEXT,
    tag TEXT,
    fill_px TEXT,
    fill_sz TEXT,
    side TEXT,
    pos_side TEXT,
    exec_type TEXT,
    fee_ccy TEXT,
    fee TEXT,
    ts TEXT,
    fill_time_ms INTEGER
);
CREATE INDEX idx_trades_ord_id ON trades(ord_id);
CREATE INDEX idx_trades_inst_id ON trades(inst_id);
CREATE INDEX idx_trades_fill_time ON trades(fill_time_ms);

-- 6. è´¦å•è¡¨
CREATE TABLE bills (
    bill_id TEXT PRIMARY KEY,
    inst_type TEXT,
    inst_id TEXT,
    ccy TEXT,
    type TEXT,
    sub_type TEXT,
    ts TEXT,
    bal_chg TEXT,
    pos_bal_chg TEXT,
    bal TEXT,
    pos_bal TEXT,
    sz TEXT,
    px TEXT,
    pnl TEXT,
    fee TEXT,
    ord_id TEXT,
    fill_mark_vol TEXT,
    fill_forward_px TEXT,
    fill_mark_px TEXT,
    fill_px TEXT,
    fill_time TEXT,
    from_account TEXT,
    to_account TEXT,
    notes TEXT,
    interest TEXT,
    trade_id TEXT,
    timestamp_ms INTEGER
);
CREATE INDEX idx_bills_ord_id ON bills(ord_id);
CREATE INDEX idx_bills_type ON bills(type);
CREATE INDEX idx_bills_timestamp ON bills(timestamp_ms);

-- 7. èµ„é‡‘è´¹ç‡è¡¨
CREATE TABLE funding_rates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inst_id TEXT,
    funding_rate TEXT,
    funding_time TEXT,
    next_funding_rate TEXT,
    next_funding_time TEXT,
    min_funding_rate TEXT,
    max_funding_rate TEXT,
    settlement_time TEXT,
    funding_time_ms INTEGER,
    next_funding_time_ms INTEGER,
    UNIQUE(inst_id, funding_time_ms)
);

-- 8. Tickerç¼“å­˜è¡¨
CREATE TABLE ticker_cache (
    inst_id TEXT PRIMARY KEY,
    last TEXT,
    last_sz TEXT,
    ask_px TEXT,
    ask_sz TEXT,
    bid_px TEXT,
    bid_sz TEXT,
    open_24h TEXT,
    high_24h TEXT,
    low_24h TEXT,
    vol_ccy_24h TEXT,
    vol_24h TEXT,
    sod_utc0 TEXT,
    sod_utc8 TEXT,
    ts TEXT,
    update_time_ms INTEGER
);

-- 9. æ·±åº¦ç¼“å­˜è¡¨
CREATE TABLE depth_cache (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inst_id TEXT,
    level INTEGER,
    side TEXT, -- bid/ask
    price TEXT,
    size TEXT,
    timestamp_ms INTEGER,
    UNIQUE(inst_id, level, side)
);

-- 10. Kçº¿ç¼“å­˜è¡¨
CREATE TABLE candle_cache (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    inst_id TEXT,
    bar TEXT,
    ts TEXT,
    open TEXT,
    high TEXT,
    low TEXT,
    close TEXT,
    vol TEXT,
    vol_ccy TEXT,
    vol_ccy_quote TEXT,
    confirm TEXT,
    timestamp_ms INTEGER,
    UNIQUE(inst_id, bar, timestamp_ms)
);

-- 11. äº§å“ä¿¡æ¯è¡¨
CREATE TABLE instruments (
    inst_id TEXT PRIMARY KEY,
    inst_type TEXT,
    uly TEXT,
    category TEXT,
    base_ccy TEXT,
    quote_ccy TEXT,
    settle_ccy TEXT,
    ct_val TEXT,
    ct_mult TEXT,
    ct_val_ccy TEXT,
    opt_type TEXT,
    stk TEXT,
    list_time TEXT,
    exp_time TEXT,
    lever TEXT,
    tick_sz TEXT,
    lot_sz TEXT,
    min_sz TEXT,
    ct_type TEXT,
    alias TEXT,
    state TEXT,
    max_lmr TEXT,
    max_mkt_sz TEXT,
    max_twap_sz TEXT,
    max_iceberg_sz TEXT,
    max_trigger_sz TEXT,
    max_stop_sz TEXT,
    update_time_ms INTEGER
);

-- 12. æ‰©å±•æ•°æ®KVè¡¨ï¼ˆç”¨äºå­˜å‚¨è‡ªå®šä¹‰å­—æ®µï¼‰
CREATE TABLE extension_data (
    key TEXT PRIMARY KEY,
    value TEXT,
    update_time INTEGER
);

-- 13. ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_config (
    key TEXT PRIMARY KEY,
    value TEXT,
    update_time INTEGER
);

-- 14. åŒæ­¥æ—¥å¿—è¡¨
CREATE TABLE sync_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    module TEXT,
    action TEXT,
    status TEXT,
    message TEXT,
    timestamp INTEGER
);
```

#### DatabaseManagerç±»è®¾è®¡

```cpp
// database_manager.h
class DatabaseManager {
public:
    bool Initialize(const string& db_path);
    
    // ==================== è´¦æˆ· ====================
    bool SaveAccountConfig(const AccountConfig& config);
    Result<AccountConfig> GetAccountConfig();
    
    bool SaveAccountBalance(const vector<AccountBalance>& balances);
    Result<vector<AccountBalance>> GetAccountBalance(const string& ccy = "");
    
    // ==================== æŒä»“ ====================
    bool SavePosition(const PositionDetail& pos);
    bool SavePositions(const vector<PositionDetail>& positions);
    Result<vector<PositionDetail>> GetPositions(
        const string& inst_id = "",
        const string& inst_type = ""
    );
    Result<PositionDetail> GetPosition(const string& pos_id);
    
    // ==================== è®¢å• ====================
    bool SaveOrder(const OrderDetail& order);
    bool SaveOrders(const vector<OrderDetail>& orders);
    Result<vector<OrderDetail>> GetOrders(
        const string& inst_id = "",
        const string& state = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    Result<OrderDetail> GetOrder(const string& ord_id);
    
    // ==================== æˆäº¤ ====================
    bool SaveTrade(const TradeDetail& trade);
    bool SaveTrades(const vector<TradeDetail>& trades);
    Result<vector<TradeDetail>> GetTrades(
        const string& ord_id = "",
        const string& inst_id = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== è´¦å• ====================
    bool SaveBill(const BillDetail& bill);
    bool SaveBills(const vector<BillDetail>& bills);
    Result<vector<BillDetail>> GetBills(
        const string& type = "",
        const string& inst_id = "",
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== èµ„é‡‘è´¹ç‡ ====================
    bool SaveFundingRate(const FundingRate& rate);
    Result<vector<FundingRate>> GetFundingRates(
        const string& inst_id,
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== ç¼“å­˜ ====================
    bool SaveTicker(const Ticker& ticker);
    Result<Ticker> GetTicker(const string& inst_id);
    
    bool SaveDepth(const Depth& depth);
    Result<Depth> GetDepth(const string& inst_id);
    
    bool SaveCandle(const Candle& candle);
    Result<vector<Candle>> GetCandles(
        const string& inst_id,
        const string& bar,
        Timestamp after = 0,
        Timestamp before = 0,
        int limit = 100
    );
    
    // ==================== åŸå§‹SQLæŸ¥è¯¢ ====================
    Result<json> ExecuteSQL(const string& sql);
    
    // ==================== æ‰©å±•æ•°æ® ====================
    bool SetExtensionData(const string& key, const string& value);
    Result<string> GetExtensionData(const string& key);
    bool DeleteExtensionData(const string& key);
    
    // ==================== ç³»ç»Ÿ ====================
    bool Backup(const string& backup_path);
    bool Vacuum();
    int64_t GetDatabaseSize();
    
private:
    unique_ptr<SQLite::Database> db_;
    mutex mutex_;
};
```

---

### æ¨¡å—M5ï¼šOKX Data Providerï¼ˆæ•°æ®èšåˆå±‚ï¼‰

**ç›®çš„**: ç»Ÿä¸€ç®¡ç†REST APIã€WebSocketã€æ•°æ®åº“

```cpp
// okx_data_provider.h
class OKXDataProvider {
public:
    // åˆå§‹åŒ–
    bool Initialize(
        const string& api_key,
        const string& secret_key,
        const string& passphrase,
        const string& db_path
    );
    
    // å¯åŠ¨
    bool Start();
    
    // åœæ­¢
    void Stop();
    
    // ==================== è‡ªåŠ¨åŒæ­¥ ====================
    
    // å¯ç”¨è‡ªåŠ¨åŒæ­¥
    void EnableAutoSync(bool enable, int interval_seconds = 60);
    
    // æ‰‹åŠ¨åŒæ­¥
    bool SyncAccount();
    bool SyncPositions();
    bool SyncOrders();
    bool SyncTrades();
    bool SyncBills();
    bool SyncAll();
    
    // ==================== æ•°æ®è·å–ï¼ˆä¼˜å…ˆä»ç¼“å­˜ï¼‰====================
    
    // è´¦æˆ·
    Result<AccountConfig> GetAccountConfig(bool force_api = false);
    Result<vector<AccountBalance>> GetBalance(const string& ccy = "", bool force_api = false);
    
    // æŒä»“
    Result<vector<PositionDetail>> GetPositions(
        const string& inst_type = "",
        const string& inst_id = "",
        bool force_api = false
    );
    
    // è®¢å•
    Result<vector<OrderDetail>> GetOrders(
        const string& inst_id = "",
        const string& state = "",
        bool force_api = false
    );
    
    // æˆäº¤
    Result<vector<TradeDetail>> GetTrades(
        const string& ord_id = "",
        const string& inst_id = "",
        bool force_api = false
    );
    
    // è´¦å•
    Result<vector<BillDetail>> GetBills(
        const string& type = "",
        const string& inst_id = "",
        bool force_api = false
    );
    
    // è¡Œæƒ…
    Result<Ticker> GetTicker(const string& inst_id, bool force_api = false);
    Result<Depth> GetDepth(const string& inst_id, bool force_api = false);
    Result<vector<Candle>> GetCandles(
        const string& inst_id,
        const string& bar = "1m",
        int limit = 100,
        bool force_api = false
    );
    
    // ==================== WebSocketè®¢é˜… ====================
    
    bool SubscribeTicker(const string& inst_id);
    bool SubscribeDepth(const string& inst_id);
    bool SubscribeOrders();
    bool SubscribePositions();
    bool SubscribeAccount();
    
    // ==================== äº¤æ˜“ ====================
    
    Result<OrderDetail> PlaceOrder(const OrderRequest& request);
    Result<OrderDetail> CancelOrder(const string& inst_id, const string& ord_id);
    
    // ==================== ç»Ÿè®¡ ====================
    
    struct Statistics {
        int total_orders;
        int filled_orders;
        int canceled_orders;
        double total_pnl;
        double total_fee;
        int total_trades;
        Timestamp last_sync_time;
    };
    
    Statistics GetStatistics();

private:
    // APIå®¢æˆ·ç«¯
    unique_ptr<OKXAPIClient> api_client_;
    
    // WebSocketå®¢æˆ·ç«¯
    unique_ptr<WebSocketClient> ws_public_;
    unique_ptr<WebSocketClient> ws_private_;
    
    // æ•°æ®åº“
    unique_ptr<DatabaseManager> db_;
    
    // è‡ªåŠ¨åŒæ­¥
    bool auto_sync_enabled_;
    int sync_interval_;
    thread sync_thread_;
    atomic<bool> running_;
    
    // ç¼“å­˜
    Cache<string, Ticker> ticker_cache_;
    Cache<string, Depth> depth_cache_;
    
    // çº¿ç¨‹å®‰å…¨
    mutex mutex_;
};
```

---

### æ¨¡å—M6ï¼šDLLå¯¼å‡ºæ¥å£ï¼ˆ60+å‡½æ•°ï¼‰

**ç›®çš„**: å°†æ‰€æœ‰åŠŸèƒ½å¯¼å‡ºä¾›MT5è°ƒç”¨

```cpp
// dllmain.cpp

extern "C" {

// ==================== åˆå§‹åŒ–/å…³é—­ ====================

__declspec(dllexport) int __stdcall OKX_Initialize(
    const char* api_key,
    const char* secret_key,
    const char* passphrase,
    const char* db_path
);

__declspec(dllexport) int __stdcall OKX_Start();

__declspec(dllexport) void __stdcall OKX_Stop();

__declspec(dllexport) void __stdcall OKX_Shutdown();

__declspec(dllexport) int __stdcall OKX_GetSystemStatus(char* out_json, int buffer_size);

// ==================== è´¦æˆ· ====================

__declspec(dllexport) int __stdcall OKX_GetAccountConfig(char* out_json, int buffer_size);

__declspec(dllexport) int __stdcall OKX_GetBalance(
    const char* ccy,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetBalanceUSD(double* out_value);

// ==================== æŒä»“ ====================

__declspec(dllexport) int __stdcall OKX_GetPositions(
    const char* inst_type,
    const char* inst_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetPosition(
    const char* inst_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetPositionCount(int* out_count);

__declspec(dllexport) int __stdcall OKX_GetTotalPnL(double* out_pnl);

// ==================== è®¢å• ====================

__declspec(dllexport) int __stdcall OKX_PlaceOrder(
    const char* request_json,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_CancelOrder(
    const char* inst_id,
    const char* ord_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetOrder(
    const char* ord_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetPendingOrders(
    const char* inst_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetOrderHistory(
    const char* inst_id,
    long after,
    long before,
    int limit,
    char* out_json,
    int buffer_size
);

// ==================== æˆäº¤ ====================

__declspec(dllexport) int __stdcall OKX_GetTrades(
    const char* ord_id,
    const char* inst_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetTradeCount(
    const char* inst_id,
    int* out_count
);

// ==================== è´¦å• ====================

__declspec(dllexport) int __stdcall OKX_GetBills(
    const char* type,
    const char* inst_id,
    long after,
    long before,
    int limit,
    char* out_json,
    int buffer_size
);

// ==================== è¡Œæƒ… ====================

__declspec(dllexport) int __stdcall OKX_GetTicker(
    const char* inst_id,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetTickerPrice(
    const char* inst_id,
    double* bid,
    double* ask
);

__declspec(dllexport) int __stdcall OKX_GetDepth(
    const char* inst_id,
    int levels,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetCandles(
    const char* inst_id,
    const char* bar,
    long after,
    long before,
    int limit,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_GetFundingRate(
    const char* inst_id,
    char* out_json,
    int buffer_size
);

// ==================== WebSocketè®¢é˜… ====================

__declspec(dllexport) int __stdcall OKX_SubscribeTicker(const char* inst_id);

__declspec(dllexport) int __stdcall OKX_SubscribeDepth(const char* inst_id);

__declspec(dllexport) int __stdcall OKX_SubscribeOrders();

__declspec(dllexport) int __stdcall OKX_SubscribePositions();

__declspec(dllexport) int __stdcall OKX_SubscribeAccount();

// ==================== æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ ====================

__declspec(dllexport) int __stdcall OKX_QueryLocalOrders(
    const char* filter_json,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_QueryLocalTrades(
    const char* filter_json,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_QueryLocalBills(
    const char* filter_json,
    char* out_json,
    int buffer_size
);

__declspec(dllexport) int __stdcall OKX_ExecuteSQL(
    const char* sql,
    char* out_json,
    int buffer_size
);

// ==================== æ‰©å±•æ•°æ® ====================

__declspec(dllexport) int __stdcall OKX_SetExtensionData(
    const char* key,
    const char* value
);

__declspec(dllexport) int __stdcall OKX_GetExtensionData(
    const char* key,
    char* out_value,
    int buffer_size
);

// ==================== åŒæ­¥ ====================

__declspec(dllexport) int __stdcall OKX_SyncAll();

__declspec(dllexport) int __stdcall OKX_SyncAccount();

__declspec(dllexport) int __stdcall OKX_SyncPositions();

__declspec(dllexport) int __stdcall OKX_SyncOrders();

__declspec(dllexport) int __stdcall OKX_EnableAutoSync(int enable, int interval_seconds);

// ==================== ç»Ÿè®¡ ====================

__declspec(dllexport) int __stdcall OKX_GetStatistics(char* out_json, int buffer_size);

} // extern "C"
```

---

### æ¨¡å—M7ï¼šAPIéªŒè¯å·¥å…·ï¼ˆMT5 EAï¼‰

**ç›®çš„**: å®Œæ•´å±•ç¤ºæ‰€æœ‰APIæ•°æ®ï¼ŒéªŒè¯åŠŸèƒ½

#### EAè®¾è®¡

```mql5
//+------------------------------------------------------------------+
//|                                         OKX_API_Validator.mq5 |
//+------------------------------------------------------------------+

#import "okx_bridge.dll"
// å¯¼å…¥æ‰€æœ‰60+ä¸ªå‡½æ•°
int OKX_Initialize(string api_key, string secret_key, string passphrase, string db_path);
int OKX_Start();
void OKX_Stop();
int OKX_GetAccountConfig(string &out_json, int buffer_size);
int OKX_GetBalance(string ccy, string &out_json, int buffer_size);
int OKX_GetPositions(string inst_type, string inst_id, string &out_json, int buffer_size);
int OKX_GetPendingOrders(string inst_id, string &out_json, int buffer_size);
int OKX_GetTrades(string ord_id, string inst_id, string &out_json, int buffer_size);
int OKX_GetBills(string type, string inst_id, long after, long before, int limit, string &out_json, int buffer_size);
int OKX_GetTicker(string inst_id, string &out_json, int buffer_size);
int OKX_GetDepth(string inst_id, int levels, string &out_json, int buffer_size);
int OKX_GetCandles(string inst_id, string bar, long after, long before, int limit, string &out_json, int buffer_size);
int OKX_GetFundingRate(string inst_id, string &out_json, int buffer_size);
int OKX_GetStatistics(string &out_json, int buffer_size);
int OKX_ExecuteSQL(string sql, string &out_json, int buffer_size);
void OKX_Shutdown();
#import

// è¾“å…¥å‚æ•°
input string API_KEY = "";
input string SECRET_KEY = "";
input string PASSPHRASE = "";
input string INST_ID = "XAUT-USDT-SWAP";

// å…¨å±€å˜é‡
bool g_initialized = false;
bool g_started = false;

// é¢æ¿å¯¹è±¡
string g_panel_prefix = "OKX_";

//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit() {
    // 1. åˆå§‹åŒ–DLL
    Print("æ­£åœ¨åˆå§‹åŒ–OKX DLL...");
    char buf[1024];
    if (OKX_Initialize(API_KEY, SECRET_KEY, PASSPHRASE, "okx_data.db") != 0) {
        Alert("DLLåˆå§‹åŒ–å¤±è´¥ï¼");
        return INIT_FAILED;
    }
    g_initialized = true;
    Print("DLLåˆå§‹åŒ–æˆåŠŸï¼");
    
    // 2. å¯åŠ¨æ•°æ®æä¾›å™¨
    Print("æ­£åœ¨å¯åŠ¨æ•°æ®æä¾›å™¨...");
    if (OKX_Start() != 0) {
        Alert("æ•°æ®æä¾›å™¨å¯åŠ¨å¤±è´¥ï¼");
        return INIT_FAILED;
    }
    g_started = true;
    Print("æ•°æ®æä¾›å™¨å¯åŠ¨æˆåŠŸï¼");
    
    // 3. åˆ›å»ºéªŒè¯é¢æ¿
    CreateValidationPanel();
    
    // 4. å¯åŠ¨å®šæ—¶å™¨ï¼ˆæ¯ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
    EventSetTimer(1);
    
    return INIT_SUCCEEDED;
}

//+------------------------------------------------------------------+
//| Expert deinitialization function                                 |
//+------------------------------------------------------------------+
void OnDeinit(const int reason) {
    EventKillTimer();
    
    if (g_started) {
        OKX_Stop();
    }
    
    if (g_initialized) {
        OKX_Shutdown();
    }
    
    DeleteAllPanelObjects();
}

//+------------------------------------------------------------------+
//| Timer function                                                   |
//+------------------------------------------------------------------+
void OnTimer() {
    // æ›´æ–°æ‰€æœ‰é¢æ¿æ•°æ®
    UpdateAccountPanel();
    UpdatePositionPanel();
    UpdateOrderPanel();
    UpdateTradePanel();
    UpdateBillPanel();
    UpdateMarketDataPanel();
    UpdateStatisticsPanel();
}

//+------------------------------------------------------------------+
//| åˆ›å»ºéªŒè¯é¢æ¿                                                     |
//+------------------------------------------------------------------+
void CreateValidationPanel() {
    int x = 10;
    int y = 30;
    int width = 800;
    int height = 600;
    
    // åˆ›å»ºèƒŒæ™¯
    CreateRectangle(g_panel_prefix + "BG", x, y, width, height, clrWhiteSmoke);
    
    // åˆ›å»ºæ ‡é¢˜
    CreateLabel(g_panel_prefix + "Title", x + 10, y + 10, "OKX APIå®Œæ•´éªŒè¯å·¥å…·", 14, clrBlack);
    
    // åˆ›å»º7ä¸ªå­é¢æ¿
    int panel_height = 70;
    int panel_y = y + 40;
    
    CreateSubPanel("Account", x, panel_y, width, panel_height, "è´¦æˆ·ä¿¡æ¯");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Position", x, panel_y, width, panel_height, "æŒä»“ä¿¡æ¯");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Order", x, panel_y, width, panel_height, "è®¢å•ä¿¡æ¯");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Trade", x, panel_y, width, panel_height, "æˆäº¤è®°å½•");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Bill", x, panel_y, width, panel_height, "è´¦å•è®°å½•");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Market", x, panel_y, width, panel_height, "è¡Œæƒ…æ•°æ®");
    panel_y += panel_height + 10;
    
    CreateSubPanel("Stats", x, panel_y, width, panel_height, "ç»Ÿè®¡ä¿¡æ¯");
}

//+------------------------------------------------------------------+
//| åˆ›å»ºå­é¢æ¿                                                       |
//+------------------------------------------------------------------+
void CreateSubPanel(string name, int x, int y, int width, int height, string title) {
    string prefix = g_panel_prefix + name + "_";
    
    // èƒŒæ™¯
    CreateRectangle(prefix + "BG", x + 5, y, width - 10, height, clrLightGray);
    
    // æ ‡é¢˜
    CreateLabel(prefix + "Title", x + 15, y + 5, title, 12, clrBlue);
    
    // å†…å®¹åŒºåŸŸï¼ˆå°†åœ¨Updateå‡½æ•°ä¸­å¡«å……ï¼‰
    CreateLabel(prefix + "Content", x + 15, y + 25, "æ­£åœ¨åŠ è½½...", 10, clrBlack);
}

//+------------------------------------------------------------------+
//| æ›´æ–°è´¦æˆ·é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdateAccountPanel() {
    char buf[65536];
    
    // è·å–è´¦æˆ·é…ç½®
    if (OKX_GetAccountConfig(buf, sizeof(buf)) == 0) {
        json config = JsonParse(buf);
        string text = StringFormat(
            "è´¦æˆ·ç­‰çº§: %s | æŒä»“æ¨¡å¼: %s | è‡ªåŠ¨å€Ÿå¸: %s",
            config["level"].ToString(),
            config["pos_mode"].ToString(),
            config["auto_loan"].ToBool() ? "å¼€å¯" : "å…³é—­"
        );
        UpdateLabelText(g_panel_prefix + "Account_Content", text);
    }
    
    // è·å–ä½™é¢
    if (OKX_GetBalance("", buf, sizeof(buf)) == 0) {
        json balances = JsonParse(buf);
        double total_eq_usd = 0;
        
        for (int i = 0; i < ArraySize(balances); i++) {
            total_eq_usd += balances[i]["eq_usd"].ToDouble();
        }
        
        string text2 = StringFormat(
            "è´¦æˆ·æƒç›Š: %.2f USD | å¸ç§æ•°é‡: %d",
            total_eq_usd,
            ArraySize(balances)
        );
        UpdateLabelText(g_panel_prefix + "Account_Content2", text2);
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°æŒä»“é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdatePositionPanel() {
    char buf[65536];
    
    if (OKX_GetPositions("", INST_ID, buf, sizeof(buf)) == 0) {
        json positions = JsonParse(buf);
        
        if (ArraySize(positions) > 0) {
            json pos = positions[0];
            
            string text = StringFormat(
                "äº§å“: %s | æ–¹å‘: %s | æ•°é‡: %s | å‡ä»·: %s | æ ‡è®°ä»·: %s | "
                "æœªå®ç°ç›ˆäº: %s | ç›ˆäºç‡: %s | ä¿è¯é‡‘ç‡: %s | æ æ†: %s",
                pos["inst_id"].ToString(),
                pos["pos_side"].ToString(),
                pos["pos"].ToString(),
                pos["avg_px"].ToString(),
                pos["mark_px"].ToString(),
                pos["upl"].ToString(),
                pos["upl_ratio"].ToString(),
                pos["margin_ratio"].ToString(),
                pos["lever"].ToString()
            );
            UpdateLabelText(g_panel_prefix + "Position_Content", text);
        } else {
            UpdateLabelText(g_panel_prefix + "Position_Content", "æ— æŒä»“");
        }
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°è®¢å•é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdateOrderPanel() {
    char buf[65536];
    
    if (OKX_GetPendingOrders(INST_ID, buf, sizeof(buf)) == 0) {
        json orders = JsonParse(buf);
        
        string text = StringFormat("æ´»è·ƒè®¢å•æ•°é‡: %d", ArraySize(orders));
        
        if (ArraySize(orders) > 0) {
            json order = orders[0];
            text += StringFormat(
                " | æœ€æ–°è®¢å•: ID=%s, æ–¹å‘=%s, ä»·æ ¼=%s, æ•°é‡=%s, çŠ¶æ€=%s",
                order["ord_id"].ToString(),
                order["side"].ToString(),
                order["px"].ToString(),
                order["sz"].ToString(),
                order["state"].ToString()
            );
        }
        
        UpdateLabelText(g_panel_prefix + "Order_Content", text);
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°æˆäº¤é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdateTradePanel() {
    char buf[65536];
    
    if (OKX_GetTrades("", INST_ID, buf, sizeof(buf)) == 0) {
        json trades = JsonParse(buf);
        
        string text = StringFormat("æˆäº¤è®°å½•æ•°é‡: %d", ArraySize(trades));
        
        if (ArraySize(trades) > 0) {
            json trade = trades[0];
            text += StringFormat(
                " | æœ€æ–°æˆäº¤: ID=%s, ä»·æ ¼=%s, æ•°é‡=%s, æ‰‹ç»­è´¹=%s",
                trade["trade_id"].ToString(),
                trade["fill_px"].ToString(),
                trade["fill_sz"].ToString(),
                trade["fee"].ToString()
            );
        }
        
        UpdateLabelText(g_panel_prefix + "Trade_Content", text);
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°è´¦å•é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdateBillPanel() {
    char buf[65536];
    
    long now = TimeCurrent() * 1000;
    long day_ago = now - 24 * 3600 * 1000;
    
    if (OKX_GetBills("", INST_ID, day_ago, now, 100, buf, sizeof(buf)) == 0) {
        json bills = JsonParse(buf);
        
        string text = StringFormat("24å°æ—¶è´¦å•æ•°é‡: %d", ArraySize(bills));
        
        double total_fee = 0;
        for (int i = 0; i < ArraySize(bills); i++) {
            total_fee += bills[i]["fee"].ToDouble();
        }
        
        text += StringFormat(" | æ€»æ‰‹ç»­è´¹: %.4f", total_fee);
        
        UpdateLabelText(g_panel_prefix + "Bill_Content", text);
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°è¡Œæƒ…æ•°æ®é¢æ¿                                                 |
//+------------------------------------------------------------------+
void UpdateMarketDataPanel() {
    char buf[65536];
    
    // Ticker
    if (OKX_GetTicker(INST_ID, buf, sizeof(buf)) == 0) {
        json ticker = JsonParse(buf);
        
        string text = StringFormat(
            "Ticker: æœ€æ–°ä»·=%s | ä¹°ä¸€=%s | å–ä¸€=%s | 24Hæˆäº¤é‡=%s | 24Hæˆäº¤é¢=%s",
            ticker["last"].ToString(),
            ticker["bid_px"].ToString(),
            ticker["ask_px"].ToString(),
            ticker["vol_24h"].ToString(),
            ticker["vol_ccy_24h"].ToString()
        );
        UpdateLabelText(g_panel_prefix + "Market_Content", text);
    }
    
    // æ·±åº¦
    if (OKX_GetDepth(INST_ID, 5, buf, sizeof(buf)) == 0) {
        json depth = JsonParse(buf);
        
        string text2 = "æ·±åº¦: ";
        for (int i = 0; i < 3 && i < ArraySize(depth["bids"]); i++) {
            text2 += StringFormat("ä¹°%d=%s@%s ", i+1, 
                depth["bids"][i][1].ToString(),
                depth["bids"][i][0].ToString()
            );
        }
        UpdateLabelText(g_panel_prefix + "Market_Content2", text2);
    }
    
    // èµ„é‡‘è´¹ç‡
    if (OKX_GetFundingRate(INST_ID, buf, sizeof(buf)) == 0) {
        json rate = JsonParse(buf);
        
        string text3 = StringFormat(
            "èµ„é‡‘è´¹ç‡: å½“å‰=%s | ä¸‹æ¬¡=%s | ä¸‹æ¬¡æ—¶é—´=%s",
            rate["funding_rate"].ToString(),
            rate["next_funding_rate"].ToString(),
            TimeToString(rate["next_funding_time"].ToDouble() / 1000)
        );
        UpdateLabelText(g_panel_prefix + "Market_Content3", text3);
    }
}

//+------------------------------------------------------------------+
//| æ›´æ–°ç»Ÿè®¡é¢æ¿                                                     |
//+------------------------------------------------------------------+
void UpdateStatisticsPanel() {
    char buf[65536];
    
    if (OKX_GetStatistics(buf, sizeof(buf)) == 0) {
        json stats = JsonParse(buf);
        
        string text = StringFormat(
            "æ€»è®¢å•: %d | æˆäº¤è®¢å•: %d | å–æ¶ˆè®¢å•: %d | "
            "æ€»ç›ˆäº: %.2f | æ€»æ‰‹ç»­è´¹: %.4f | æ€»æˆäº¤: %d | "
            "æœ€ååŒæ­¥: %s",
            (int)stats["total_orders"].ToDouble(),
            (int)stats["filled_orders"].ToDouble(),
            (int)stats["canceled_orders"].ToDouble(),
            stats["total_pnl"].ToDouble(),
            stats["total_fee"].ToDouble(),
            (int)stats["total_trades"].ToDouble(),
            TimeToString(stats["last_sync_time"].ToDouble() / 1000)
        );
        UpdateLabelText(g_panel_prefix + "Stats_Content", text);
    }
}

//+------------------------------------------------------------------+
//| è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºçŸ©å½¢                                               |
//+------------------------------------------------------------------+
void CreateRectangle(string name, int x, int y, int width, int height, color clr) {
    ObjectCreate(0, name, OBJ_RECTANGLE_LABEL, 0, 0, 0);
    ObjectSetInteger(0, name, OBJPROP_XDISTANCE, x);
    ObjectSetInteger(0, name, OBJPROP_YDISTANCE, y);
    ObjectSetInteger(0, name, OBJPROP_XSIZE, width);
    ObjectSetInteger(0, name, OBJPROP_YSIZE, height);
    ObjectSetInteger(0, name, OBJPROP_BGCOLOR, clr);
    ObjectSetInteger(0, name, OBJPROP_BORDER_TYPE, BORDER_FLAT);
    ObjectSetInteger(0, name, OBJPROP_CORNER, CORNER_LEFT_UPPER);
}

//+------------------------------------------------------------------+
//| è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºæ ‡ç­¾                                               |
//+------------------------------------------------------------------+
void CreateLabel(string name, int x, int y, string text, int font_size, color clr) {
    ObjectCreate(0, name, OBJ_LABEL, 0, 0, 0);
    ObjectSetInteger(0, name, OBJPROP_XDISTANCE, x);
    ObjectSetInteger(0, name, OBJPROP_YDISTANCE, y);
    ObjectSetString(0, name, OBJPROP_TEXT, text);
    ObjectSetInteger(0, name, OBJPROP_FONTSIZE, font_size);
    ObjectSetInteger(0, name, OBJPROP_COLOR, clr);
    ObjectSetInteger(0, name, OBJPROP_CORNER, CORNER_LEFT_UPPER);
}

//+------------------------------------------------------------------+
//| è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°æ ‡ç­¾æ–‡æœ¬                                           |
//+------------------------------------------------------------------+
void UpdateLabelText(string name, string text) {
    ObjectSetString(0, name, OBJPROP_TEXT, text);
}

//+------------------------------------------------------------------+
//| è¾…åŠ©å‡½æ•°ï¼šåˆ é™¤æ‰€æœ‰é¢æ¿å¯¹è±¡                                       |
//+------------------------------------------------------------------+
void DeleteAllPanelObjects() {
    int total = ObjectsTotal(0);
    for (int i = total - 1; i >= 0; i--) {
        string name = ObjectName(0, i);
        if (StringFind(name, g_panel_prefix) == 0) {
            ObjectDelete(0, name);
        }
    }
}
```

---

## ğŸ¯ å¼€å‘è®¡åˆ’

### Week 1: æ•°æ®åŸºç¡€ï¼ˆM1-M4ï¼‰

#### Day 1-2: æ•°æ®ç»“æ„ + REST API
- [ ] å®ŒæˆOKXå…¨å­—æ®µæ•°æ®ç»“æ„å®šä¹‰
- [ ] å®ç°OKXAPIClientç±»
- [ ] å®ç°ç­¾åç®—æ³•
- [ ] å•å…ƒæµ‹è¯•ï¼ˆè´¦æˆ·/æŒä»“/è®¢å•APIï¼‰

#### Day 3-4: WebSocket + æ•°æ®åº“
- [ ] å®ç°WebSocketClientç±»
- [ ] å®ç°è‡ªåŠ¨é‡è¿å’Œå¿ƒè·³
- [ ] åˆ›å»º14å¼ æ•°æ®åº“è¡¨
- [ ] å®ç°DatabaseManagerç±»
- [ ] å•å…ƒæµ‹è¯•

#### Day 5: æ•°æ®èšåˆå±‚
- [ ] å®ç°OKXDataProviderç±»
- [ ] å®ç°ç¼“å­˜æœºåˆ¶
- [ ] å®ç°è‡ªåŠ¨åŒæ­¥
- [ ] é›†æˆæµ‹è¯•

### Week 2: DLLå¯¼å‡º + éªŒè¯å·¥å…·ï¼ˆM5-M7ï¼‰

#### Day 1-2: DLLå¯¼å‡ºæ¥å£
- [ ] å®ç°60+ä¸ªå¯¼å‡ºå‡½æ•°
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] ç¼–è¯‘æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

#### Day 3-4: MT5éªŒè¯å·¥å…·
- [ ] åˆ›å»ºéªŒè¯EA
- [ ] å®ç°7ä¸ªæ•°æ®é¢æ¿
- [ ] æµ‹è¯•æ‰€æœ‰APIè°ƒç”¨
- [ ] å‹åŠ›æµ‹è¯•

#### Day 5: æ–‡æ¡£ä¸æ‰“åŒ…
- [ ] APIæ–‡æ¡£ï¼ˆDoxygenï¼‰
- [ ] ç”¨æˆ·æ‰‹å†Œ
- [ ] é…ç½®æ–‡ä»¶æ¨¡æ¿
- [ ] å®‰è£…è„šæœ¬

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] æ‰€æœ‰OKXç§æœ‰APIå­—æ®µéƒ½å·²æ˜ å°„
- [ ] 14å¼ æ•°æ®åº“è¡¨å…¨éƒ¨åˆ›å»º
- [ ] 60+ä¸ªDLLå¯¼å‡ºå‡½æ•°æ­£å¸¸å·¥ä½œ
- [ ] WebSocketå®æ—¶æ¨é€æ­£å¸¸
- [ ] REST APIè°ƒç”¨æ­£å¸¸
- [ ] éªŒè¯å·¥å…·èƒ½å±•ç¤ºæ‰€æœ‰æ•°æ®

### æ€§èƒ½æŒ‡æ ‡
- [ ] Tickå¤„ç†å»¶è¿Ÿ < 5ms
- [ ] REST APIè°ƒç”¨å»¶è¿Ÿ < 100ms
- [ ] æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ < 20ms
- [ ] å†…å­˜å ç”¨ < 150MB
- [ ] 24å°æ—¶è¿ç»­è¿è¡Œæ— å´©æºƒ

### æ‰©å±•æ€§éªŒè¯
- [ ] æ–°å¢å¸ç§æ— éœ€é‡æ–°ç¼–è¯‘
- [ ] è‡ªå®šä¹‰SQLæŸ¥è¯¢æ­£å¸¸
- [ ] é…ç½®æ–‡ä»¶çƒ­é‡è½½æ­£å¸¸
- [ ] æ›´æ¢APIåªéœ€ä¿®æ”¹é…ç½®

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

1. **æºä»£ç **
   - C++ DLLæºç ï¼ˆå®Œæ•´æ³¨é‡Šï¼‰
   - MT5 EAéªŒè¯å·¥å…·
   - é…ç½®æ–‡ä»¶æ¨¡æ¿

2. **ç¼–è¯‘æ–‡ä»¶**
   - okx_bridge.dll (64ä½)
   - OKX_API_Validator.ex5

3. **æ–‡æ¡£**
   - APIå®Œæ•´æ–‡æ¡£ï¼ˆHTMLï¼‰
   - ç”¨æˆ·æ‰‹å†Œï¼ˆPDFï¼‰
   - å¼€å‘è€…æŒ‡å—
   - æ•°æ®åº“Schemaæ–‡æ¡£

4. **æµ‹è¯•æŠ¥å‘Š**
   - å•å…ƒæµ‹è¯•æŠ¥å‘Š
   - é›†æˆæµ‹è¯•æŠ¥å‘Š
   - æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
   - 24å°æ—¶ç¨³å®šæ€§æµ‹è¯•æŠ¥å‘Š

---

**å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿè®©æˆ‘çŸ¥é“æ‚¨æ˜¯å¦éœ€è¦è°ƒæ•´ä»»ä½•å†…å®¹ï¼** ğŸš€
